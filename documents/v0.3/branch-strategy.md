# ブランチ戦略メモ

## 1. 概要
v0.3開発におけるGit ブランチ戦略を定義する。

## 2. ブランチ構成

```
main
  │
  ├── feature/v0.2.1 (現在の安定版)
  │
  └── feature/v0.3 (v0.3開発ブランチ)
        │
        ├── feature/v0.3-db-models
        ├── feature/v0.3-core-scripts
        ├── feature/v0.3-backend
        ├── feature/v0.3-worker
        └── feature/v0.3-testing
```

## 3. 各ブランチの役割

| ブランチ | 役割 | マージ先 |
|---------|------|---------|
| `main` | 本番環境 | - |
| `feature/v0.2.1` | v0.2系の修正・運用 | main |
| `feature/v0.3` | v0.3統合ブランチ | main (v0.3完了後) |
| `feature/v0.3-*` | 機能別開発ブランチ | feature/v0.3 |

## 4. v0.2並走の方針

### 4.1 並走期間中の運用

```
期間: v0.3開発完了まで

v0.2.1運用:
  - mainからデプロイ
  - 緊急修正はfeature/v0.2.1で実施
  - v0.3へのバックポートは不要（アーキテクチャ違い）

v0.3開発:
  - feature/v0.3で開発
  - テスト環境でのみ動作確認
  - 本番デプロイはv0.3完了後一括
```

### 4.2 切替ポイント

```
v0.3完了条件:
  1. 全テストPASS
  2. 手動テスト完了
  3. ドキュメント更新完了

切替手順:
  1. v0.2運用停止
  2. feature/v0.3 → main にマージ
  3. DB Migration実行
  4. 本番デプロイ
  5. 動作確認
```

## 5. main保護戦略

### 5.1 保護ルール

- 直接push禁止
- PR必須
- 1名以上のレビュー必須（将来）
- CI PASS必須

### 5.2 現状の対応

1名開発のため、自己レビューで進める:
- PR作成時にセルフレビュー
- CIチェックを必須条件

## 6. マージ戦略

### 6.1 機能ブランチ → feature/v0.3

```
方法: Squash and Merge

理由:
  - 履歴をきれいに保つ
  - 1機能=1コミット
```

### 6.2 feature/v0.3 → main

```
方法: Merge Commit

理由:
  - v0.3全体のマイルストーンとして残す
  - revert容易
```

## 7. タグ運用

```
v0.2.1  : 現在の安定版タグ
v0.3.0  : v0.3リリースタグ
v0.3.1  : マイナーアップデート
```

## 8. 緊急時の対応

### 8.1 v0.3で重大バグ発見

```
1. feature/v0.3で修正
2. テスト追加
3. PR作成
4. 再デプロイ
```

### 8.2 v0.2への緊急ロールバック

```
1. mainをv0.2.1タグにreset
2. 強制デプロイ
3. DBをバックアップから復元
```

**注意**: DBスキーマが異なるため、ロールバックはDBの復元も必要。

## 9. 関連ドキュメント

- v0.3_design.md: 12. 実装タスクリスト
- deletion-policy.md: 削除方針
